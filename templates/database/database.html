{% extends "base.html" %} {% block title %}RPPYG Maker Database{% endblock %} {%
block content %}
<h1>Database</h1>
<div style="height: 22px"></div>

<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
    <li class="nav-item" role="presentation">
        <button
            class="nav-link active"
            id="pills-characters-tab"
            data-bs-toggle="pill"
            data-bs-target="#pills-characters"
            type="button"
            role="tab"
            aria-controls="pills-characters"
            aria-selected="true"
        >
            Characters 🦹‍♂️
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button
            class="nav-link"
            id="pills-commands-tab"
            data-bs-toggle="pill"
            data-bs-target="#pills-commands"
            type="button"
            role="tab"
            aria-controls="pills-commands"
            aria-selected="false"
        >
            Commands 📜
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button
            class="nav-link"
            id="pills-skills-tab"
            data-bs-toggle="pill"
            data-bs-target="#pills-skills"
            type="button"
            role="tab"
            aria-controls="pills-skills"
            aria-selected="false"
        >
            Skills 💥
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button
            class="nav-link"
            id="pills-items-tab"
            data-bs-toggle="pill"
            data-bs-target="#pills-items"
            type="button"
            role="tab"
            aria-controls="pills-items"
            aria-selected="false"
        >
            Items 🍪
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button
            class="nav-link"
            id="pills-tilemaps-tab"
            data-bs-toggle="pill"
            data-bs-target="#pills-tilesets"
            type="button"
            role="tab"
            aria-controls="pills-tilesets"
            aria-selected="false"
        >
            Tilesets 🏞️
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button
            class="nav-link"
            id="pills-battles-tab"
            data-bs-toggle="pill"
            data-bs-target="#pills-battles"
            type="button"
            role="tab"
            aria-controls="pills-battles"
            aria-selected="false"
        >
            Battles ⚔️
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button
            class="nav-link"
            id="pills-enemies-tab"
            data-bs-toggle="pill"
            data-bs-target="#pills-enemies"
            type="button"
            role="tab"
            aria-controls="pills-enemies"
            aria-selected="false"
        >
            Enemies 👿
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button
            class="nav-link"
            id="pills-games-tab"
            data-bs-toggle="pill"
            data-bs-target="#pills-games"
            type="button"
            role="tab"
            aria-controls="pills-games"
            aria-selected="false"
        >
            Games 🎮
        </button>
    </li>
</ul>
<div class="tab-content" id="pills-tabContent">
    <div
        class="tab-pane fade show active"
        id="pills-characters"
        role="tabpanel"
        aria-labelledby="pills-characters-tab"
    >
        characters...
    </div>
    <div
        class="tab-pane fade"
        id="pills-skills"
        role="tabpanel"
        aria-labelledby="pills-skills-tab"
    >
        <!-- Skills table form -->
        <form method="POST">
            <button type="submit" name="save_skills" class="btn btn-success">
                💾 Save
            </button>
            <div style="height: 22px"></div>
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>Skill Name</th>
                        <th>Image</th>
                        <th>Description</th>
                        <th>Skill Effect</th>
                        <th style="width: 5%"></th>
                    </tr>
                </thead>
                <tbody id="skillsTableBody">
                    {% for skill_name, skill_data in context.skillsjson.items()
                    %}
                    <tr>
                        <td>
                            <input
                                type="text"
                                name="skill_name"
                                value="{{ skill_name }}"
                                class="form-control"
                                required
                            />
                        </td>
                        <td>
                            <input
                                type="text"
                                name="skill_img"
                                value="{{ skill_data.img }}"
                                class="form-control"
                            />
                        </td>
                        <td>
                            <textarea name="skill_desc" class="form-control">
{{ skill_data.description }}</textarea
                            >
                        </td>
                        <td>
                            <textarea name="skill_effect" class="form-control">
{{ skill_data.effect }}</textarea
                            >
                        </td>
                        <td>
                            <button
                                type="button"
                                class="btn btn-danger btn-sm"
                                onclick="this.closest('tr').remove()"
                            >
                                Delete
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
        <!-- Add new skill form -->
        <form method="POST" class="mb-4">
            <div class="input-group">
                <input
                    type="text"
                    name="skill_name"
                    class="form-control"
                    placeholder="New skill name"
                    required
                />
                <button type="submit" name="add_skill" class="btn btn-primary">
                    Add Skill
                </button>
            </div>
        </form>
    </div>
    <div
        class="tab-pane fade"
        id="pills-commands"
        role="tabpanel"
        aria-labelledby="pills-commands-tab"
        style="position: absolute; left: 0; width: 100%"
    >
        <!-- Commands table form -->
        <form method="POST">
            <button type="submit" name="save_commands" class="btn btn-success">
                💾 Save
            </button>
            <div style="height: 22px"></div>
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>Command Location</th>
                        <th>Commands</th>
                    </tr>
                </thead>
                <tbody id="commandsTableBody">
                    {% for command_location, commands_data in
                    context.commandsjson.items() %}
                    <tr>
                        <td>
                            <input
                                type="text"
                                name="command_location"
                                value="{{ command_location }}"
                                class="form-control"
                                required
                            />
                        </td>
                        <td>
                            <table class="table table-bordered mb-3">
                                <thead>
                                    <tr>
                                        <th>Command Name</th>
                                        <th>Trigger by</th>
                                        <th>Sequence</th>
                                        <th style="width: 7%">Position x</th>
                                        <th style="width: 7%">Position y</th>
                                        <th style="width: 5%">Show</th>
                                        <th>Image</th>
                                        <th style="width: 5%">Has Collision</th>
                                        <th style="width: 5%">Run in loop</th>
                                        <th style="width: 5%"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for command_name, command_variable in
                                    commands_data.items() %}
                                    <tr>
                                        <td>
                                            <input
                                                type="hidden"
                                                name="hidden_command_location"
                                                value="{{ command_location }}"
                                            />
                                            <input
                                                type="text"
                                                name="command_name"
                                                value="{{ command_name }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="text"
                                                name="command_trigger_by"
                                                value="{{ command_variable.trigger_by }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <!-- Sequence -->
                                            <table
                                                class="table table-bordered mb-3"
                                            >
                                                <thead>
                                                    <tr>
                                                        <th style="width: 5%">
                                                            Type
                                                        </th>
                                                        <th>Value</th>
                                                        <th
                                                            style="width: 5%"
                                                        ></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <input
                                                        type="hidden"
                                                        name="sequence_length"
                                                        value="{{ command_variable.sequence|length }}"
                                                    />
                                                    {% for sequence in
                                                    command_variable.sequence %}
                                                    <tr>
                                                        <td>
                                                            {{ sequence.type }}
                                                            <input
                                                                type="hidden"
                                                                name="sequence_type"
                                                                value="{{ sequence.type }}"
                                                            />
                                                        </td>
                                                        <td>
                                                            {% if sequence.type
                                                            == 'conversation' %}
                                                            <table
                                                                class="table table-bordered mb-3"
                                                            >
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Dialogs
                                                                        </th>
                                                                        <th
                                                                            style="
                                                                                width: 5%;
                                                                            "
                                                                        ></th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <input
                                                                        type="hidden"
                                                                        name="sequence_dialog_length"
                                                                        value="{{ sequence.dialogs|length }}"
                                                                    />
                                                                    {% for
                                                                    dialog in
                                                                    sequence.dialogs
                                                                    %}
                                                                    <tr>
                                                                        <td>
                                                                            <textarea
                                                                                class="form-control"
                                                                                name="sequence_dialog"
                                                                            >
{{ dialog }}</textarea
                                                                            >
                                                                        </td>
                                                                        <td>
                                                                            <button
                                                                                type="button"
                                                                                class="btn btn-danger btn-sm"
                                                                                onclick="
                                                                                const row = this.closest('tr');
                                                                                const table = this.closest('table');
                                                                                const seqLengthInput = table.querySelector('input[name=\'sequence_dialog_length\']');

                                                                                // Remove the row
                                                                                row.remove();

                                                                                // Update the hidden input value
                                                                                const updatedLength = table.querySelectorAll('tbody > tr').length;
                                                                                seqLengthInput.value = updatedLength;
                                                                                "
                                                                            >
                                                                                Delete
                                                                            </button>
                                                                        </td>
                                                                    </tr>
                                                                    {% endfor %}
                                                                </tbody>
                                                            </table>
                                                            <!-- Add new dialog form -->
                                                            <form
                                                                method="POST"
                                                                class="input-group"
                                                            >
                                                                <input
                                                                    type="text"
                                                                    name="latest_dialog"
                                                                    value="{{ sequence.dialogs[-1] }}"
                                                                    hidden
                                                                />
                                                                <input
                                                                    type="text"
                                                                    name="new_dialog_command_name"
                                                                    value="{{ command_name }}"
                                                                    hidden
                                                                />
                                                                <input
                                                                    type="text"
                                                                    name="new_dialog_command_location"
                                                                    value="{{ command_location }}"
                                                                    hidden
                                                                />
                                                                <input
                                                                    type="text"
                                                                    name="new_dialog"
                                                                    class="form-control"
                                                                    placeholder="New Dialog"
                                                                />
                                                                <button
                                                                    type="submit"
                                                                    name="add_dialog"
                                                                    class="btn btn-primary"
                                                                >
                                                                    Add Dialog
                                                                </button>
                                                            </form>
                                                            {% endif %} {% if
                                                            sequence.type ==
                                                            'python_script' %}
                                                            <textarea
                                                                class="form-control"
                                                                name="sequence_python_script"
                                                            >
{{ sequence.script }}</textarea
                                                            >
                                                            {% endif %} {% if
                                                            sequence.type ==
                                                            'add_item' %}
                                                            <table
                                                                class="table table-bordered mb-3"
                                                            >
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Item
                                                                            Name
                                                                        </th>
                                                                        <th
                                                                            style="
                                                                                width: 5%;
                                                                            "
                                                                        >
                                                                            Quantity
                                                                        </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td>
                                                                            <input
                                                                                type="text"
                                                                                class="form-control"
                                                                                name="sequence_add_item_name"
                                                                                value="{{ sequence.item }}"
                                                                            />
                                                                        </td>
                                                                        <td>
                                                                            <input
                                                                                type="number"
                                                                                class="form-control"
                                                                                name="sequence_add_item_quant"
                                                                                value="{{ sequence.quant }}"
                                                                            />
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            {% endif %} {% if
                                                            sequence.type ==
                                                            'remove_item' %}
                                                            <table
                                                                class="table table-bordered mb-3"
                                                            >
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Item
                                                                            Name
                                                                        </th>
                                                                        <th
                                                                            style="
                                                                                width: 5%;
                                                                            "
                                                                        >
                                                                            Quantity
                                                                        </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td>
                                                                            <input
                                                                                type="text"
                                                                                class="form-control"
                                                                                name="sequence_remove_item_name"
                                                                                value="{{ sequence.item }}"
                                                                            />
                                                                        </td>
                                                                        <td>
                                                                            <input
                                                                                type="number"
                                                                                class="form-control"
                                                                                name="sequence_remove_item_quant"
                                                                                value="{{ sequence.quant }}"
                                                                            />
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            {% endif %} {% if
                                                            sequence.type ==
                                                            'add_skill' %}
                                                            <table
                                                                class="table table-bordered mb-3"
                                                            >
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Skill
                                                                            Name
                                                                        </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td>
                                                                            <input
                                                                                type="text"
                                                                                class="form-control"
                                                                                name="sequence_add_skill_name"
                                                                                value="{{ sequence.skill }}"
                                                                            />
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            {% endif %} {% if
                                                            sequence.type ==
                                                            'remove_skill' %}
                                                            <table
                                                                class="table table-bordered mb-3"
                                                            >
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Skill
                                                                            Name
                                                                        </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td>
                                                                            <input
                                                                                type="text"
                                                                                class="form-control"
                                                                                name="sequence_remove_skill_name"
                                                                                value="{{ sequence.skill }}"
                                                                            />
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            {% endif %} {% if
                                                            sequence.type ==
                                                            'teleport' %}
                                                            <table
                                                                class="table table-bordered mb-3"
                                                            >
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            Map
                                                                            Name
                                                                        </th>
                                                                        <th
                                                                            style="
                                                                                width: 20%;
                                                                            "
                                                                        >
                                                                            Position
                                                                            x
                                                                        </th>
                                                                        <th
                                                                            style="
                                                                                width: 20%;
                                                                            "
                                                                        >
                                                                            Position
                                                                            y
                                                                        </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td>
                                                                            <input
                                                                                type="text"
                                                                                class="form-control"
                                                                                name="sequence_map_name"
                                                                                value="{{ sequence.map_name }}"
                                                                            />
                                                                        </td>
                                                                        <td>
                                                                            <input
                                                                                type="number"
                                                                                class="form-control"
                                                                                name="sequence_position_x"
                                                                                value="{{ sequence.position[0] }}"
                                                                            />
                                                                        </td>
                                                                        <td>
                                                                            <input
                                                                                type="number"
                                                                                class="form-control"
                                                                                name="sequence_position_y"
                                                                                value="{{ sequence.position[1] }}"
                                                                            />
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            <button
                                                                type="button"
                                                                class="btn btn-danger btn-sm"
                                                                onclick="
                                                                const row = this.closest('tr');
                                                                const table = row.closest('table'); // Get the parent table
                                                                const seqLengthInput = table.querySelector('input[name=\'sequence_length\']');

                                                                // Remove the row
                                                                row.remove();

                                                                // Correctly count only the direct rows in the main table
                                                                const updatedLength = [...table.querySelectorAll('tbody > tr')]
                                                                    .filter(tr => tr.closest('table') === table).length;

                                                                seqLengthInput.value = updatedLength;

                                                                "
                                                            >
                                                                Delete
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>

                                            <!-- Add new sequence form -->
                                            <form
                                                method="POST"
                                                class="input-group"
                                            >
                                                <input
                                                    name="new_sequence_command_name"
                                                    value="{{ command_name }}"
                                                    hidden
                                                />
                                                <input
                                                    name="new_sequence_location"
                                                    value="{{ command_location }}"
                                                    hidden
                                                />
                                                <input
                                                    type="text"
                                                    name="new_sequence_type"
                                                    class="form-control"
                                                    placeholder="New Sequence type"
                                                />
                                                <button
                                                    type="submit"
                                                    name="add_sequence"
                                                    class="btn btn-primary"
                                                >
                                                    Add Sequence
                                                </button>
                                            </form>
                                        </td>
                                        <td>
                                            <input
                                                type="number"
                                                name="command_position_x"
                                                value="{{ command_variable.position[0] }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="number"
                                                name="command_position_y"
                                                value="{{ command_variable.position[1] }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="text"
                                                name="command_show"
                                                value="{{ command_variable.show }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="text"
                                                name="command_image"
                                                value="{{ command_variable.img }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="text"
                                                name="command_has_collision"
                                                value="{{ command_variable.has_collision }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="text"
                                                name="command_run_in_loop"
                                                value="{{ command_variable.run_in_loop }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <button
                                                type="button"
                                                class="btn btn-danger btn-sm"
                                                onclick="this.closest('tr').remove()"
                                            >
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>

                            <!-- Add new command form -->
                            <form method="POST" class="input-group">
                                <input
                                    type="hidden"
                                    name="command_location"
                                    value="{{ command_location }}"
                                />
                                <input
                                    type="text"
                                    name="new_command_name"
                                    class="form-control"
                                    placeholder="New Command name"
                                />
                                <button
                                    type="submit"
                                    name="add_command"
                                    class="btn btn-primary"
                                >
                                    Add Command
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
    </div>
    <div
        class="tab-pane fade"
        id="pills-items"
        role="tabpanel"
        aria-labelledby="pills-items-tab"
    >
        <!-- Items table form -->
        <form method="POST">
            <button type="submit" name="save_items" class="btn btn-success">
                💾 Save
            </button>
            <div style="height: 22px"></div>
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>Item Name</th>
                        <th>Image</th>
                        <th>Description</th>
                        <th style="width: 10%">Is Key Item</th>
                        <th style="width: 10%">Is Equipable</th>
                        <th style="width: 10%">Is Consumable</th>
                        <th>Consume Effect</th>
                        <th style="width: 5%"></th>
                    </tr>
                </thead>
                <tbody id="itemsTableBody">
                    {% for item_name, item_data in context.itemsjson.items() %}
                    <tr>
                        <td>
                            <input
                                type="text"
                                name="item_name"
                                value="{{ item_name }}"
                                class="form-control"
                                required
                            />
                        </td>
                        <td>
                            <input
                                type="text"
                                name="item_img"
                                value="{{ item_data.img }}"
                                class="form-control"
                            />
                        </td>
                        <td>
                            <textarea name="item_desc" class="form-control">
{{ item_data.description }}</textarea
                            >
                        </td>
                        <td>
                            <input
                                type="text"
                                name="item_key"
                                value="{{ item_data.key_item }}"
                                class="form-control"
                            />
                        </td>
                        <td>
                            <input
                                type="text"
                                name="item_equip"
                                value="{{ item_data.equipable }}"
                                class="form-control"
                            />
                        </td>
                        <td>
                            <input
                                type="text"
                                name="item_consume"
                                value="{{ item_data.consumable }}"
                                class="form-control"
                            />
                        </td>
                        <td>
                            <textarea
                                name="item_consume_effect"
                                class="form-control"
                            >
{{ item_data.consume_effect }}</textarea
                            >
                        </td>
                        <td>
                            <button
                                type="button"
                                class="btn btn-danger btn-sm"
                                onclick="this.closest('tr').remove()"
                            >
                                Delete
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
        <!-- Add new item form -->
        <form method="POST" class="mb-4">
            <div class="input-group">
                <input
                    type="text"
                    name="item_name"
                    class="form-control"
                    placeholder="New item name"
                    required
                />
                <button type="submit" name="add_item" class="btn btn-primary">
                    Add Item
                </button>
            </div>
        </form>
    </div>
    <div
        class="tab-pane fade"
        id="pills-tilesets"
        role="tabpanel"
        aria-labelledby="pills-tilesets-tab"
    >
        <!-- Tilesets table form -->
        <form method="POST">
            <button type="submit" name="save_tilesets" class="btn btn-success">
                💾 Save
            </button>
            <div style="height: 22px"></div>
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>Tileset Name</th>
                        <th>Tiles</th>
                        <th style="width: 5%"></th>
                    </tr>
                </thead>
                <tbody id="tilesetsTableBody">
                    {% for tileset_name, tiles in context.tilesetsjson.items()
                    %}
                    <tr>
                        <td>
                            <input
                                type="text"
                                name="tileset_name"
                                value="{{ tileset_name }}"
                                class="form-control"
                                required
                            />
                        </td>
                        <td>
                            <table class="table table-bordered mb-3">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Tile Name</th>
                                        <th style="width: 5%"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for tile_id, tile_name in tiles.items()
                                    %}
                                    <tr>
                                        <td>
                                            <input
                                                type="hidden"
                                                name="hidden_tileset_name"
                                                value="{{ tileset_name }}"
                                            />
                                            <input
                                                type="text"
                                                name="tile_id"
                                                value="{{ tile_id }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="text"
                                                name="tile_name"
                                                value="{{ tile_name }}"
                                                class="form-control"
                                                required
                                            />
                                        </td>
                                        <td>
                                            <button
                                                type="button"
                                                class="btn btn-danger btn-sm"
                                                onclick="this.closest('tr').remove()"
                                            >
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>

                            <!-- Add new tile form -->
                            <form method="POST" class="input-group">
                                <input
                                    type="hidden"
                                    name="tileset_name"
                                    value="{{ tileset_name }}"
                                />
                                <input
                                    type="text"
                                    name="new_tile_name"
                                    class="form-control"
                                    placeholder="New tile name"
                                />
                                <button
                                    type="submit"
                                    name="add_tile"
                                    class="btn btn-primary"
                                >
                                    Add Tile
                                </button>
                            </form>
                        </td>
                        <td>
                            <button
                                type="button"
                                class="btn btn-danger btn-sm"
                                onclick="this.closest('tr').remove()"
                            >
                                Delete
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>

        <!-- Add new tileset form -->
        <form method="POST" class="mb-4">
            <div class="input-group">
                <input
                    type="text"
                    name="tileset_name"
                    class="form-control"
                    placeholder="New tileset name"
                    required
                />
                <button
                    type="submit"
                    name="add_tileset"
                    class="btn btn-primary"
                >
                    Add Tileset
                </button>
            </div>
        </form>
    </div>
    <div
        class="tab-pane fade"
        id="pills-battles"
        role="tabpanel"
        aria-labelledby="pills-battles-tab"
    >
        battles...
    </div>
    <div
        class="tab-pane fade"
        id="pills-enemies"
        role="tabpanel"
        aria-labelledby="pills-enemies-tab"
    >
        enemies...
    </div>
    <div
        class="tab-pane fade"
        id="pills-games"
        role="tabpanel"
        aria-labelledby="pills-games-tab"
    >
        <form method="POST">
            <button type="submit" name="save_main" class="btn btn-success">
                💾 Save
            </button>
            <div style="height: 22px"></div>
            Game Title:
            <input
                type="text"
                id="main_title"
                name="main_title"
                class="form-control"
                value="{{ context.dbjson.main.main_title }}"
            /><br />
            Start Map:
            <input
                type="text"
                id="start_map"
                name="start_map"
                class="form-control"
                value="{{ context.dbjson.start_map }}"
            /><br />
            Player Start Position <br />
            X:
            <input
                type="number"
                id="player_start_position_x"
                name="player_start_position_x"
                class="form-control"
                value="{{ context.dbjson.player_start_position[0] }}"
            />
            Y:
            <input
                type="number"
                id="player_start_position_y"
                name="player_start_position_y"
                class="form-control"
                value="{{ context.dbjson.player_start_position[1] }}"
            /><br />
            Player Start HP:<br />
            <input
                type="number"
                id="player_start_hp"
                name="player_start_hp"
                class="form-control"
                value="{{ context.dbjson.player_start_hp }}"
            /><br />
            Maps:
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>Map Name</th>
                        <th>Tileset</th>
                        <th>CSV Column</th>
                        <th>CSV Row</th>
                        <th style="width: 5%"></th>
                    </tr>
                </thead>
                <tbody id="mapsTableBody">
                    {% for map_data in context.dbjson.maps %}
                    <tr>
                        <td>
                            <input
                                type="text"
                                name="map_name"
                                value="{{ map_data.name }}"
                                class="form-control"
                            />
                        </td>
                        <td>
                            <input
                                type="text"
                                name="map_tileset"
                                value="{{ map_data.tileset }}"
                                class="form-control"
                            />
                        </td>
                        <td>
                            <input
                                type="number"
                                name="map_width"
                                value="{{ map_data.size[0] }}"
                                class="form-control"
                            />
                        </td>
                        <td>
                            <input
                                type="number"
                                name="map_height"
                                value="{{ map_data.size[1] }}"
                                class="form-control"
                            />
                        </td>
                        <td>
                            <button
                                type="button"
                                class="btn btn-danger btn-sm"
                                onclick="this.closest('tr').remove()"
                            >
                                Delete
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
        <!-- Add new map form -->
        <form method="POST" class="mb-4">
            <div class="input-group">
                <input
                    type="text"
                    name="map_name"
                    class="form-control"
                    placeholder="New map name"
                    required
                />
                <button type="submit" name="add_map" class="btn btn-primary">
                    Add Map
                </button>
            </div>
        </form>
    </div>
</div>

{% endblock %}
